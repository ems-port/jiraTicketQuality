<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Jira ITSM Conversation Quality</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css" />
    <link rel="stylesheet" href="/static/styles.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  </head>
  <body>
    <main class="container">
      <header>
        <h1>Jira ITSM Conversation Quality</h1>
        <p class="lead">Proof-of-concept dashboard that scores daily Jira conversations with the help of an LLM pipeline.</p>
        <p class="meta">Last updated: {{ last_updated }}</p>
      </header>

      <section>
        <h2>Health Snapshot</h2>
        <div class="grid">
          {% for label, values in metrics.items() %}
          <article>
            <h3>{{ label }}</h3>
            <p><strong>{{ values.total_conversations }}</strong> conversations</p>
            <p>Average quality <strong>{{ values.avg_quality }}</strong> · Agent score <strong>{{ values.avg_agent_score }}</strong></p>
            <p>{{ values.needs_improvement }} need attention · {{ values.abusive_count }} abusive</p>
            {% if values.improvement_examples %}
            <details>
              <summary>Improvement notes</summary>
              <ul>
                {% for note in values.improvement_examples %}
                <li>{{ note }}</li>
                {% endfor %}
              </ul>
            </details>
            {% endif %}
          </article>
          {% endfor %}
        </div>
      </section>

      <section>
        <h2>Trends</h2>
        <div class="grid">
          <article>
            <h3>Quality Score</h3>
            <canvas id="qualityChart"></canvas>
          </article>
          <article>
            <h3>Agent Score</h3>
            <canvas id="agentChart"></canvas>
          </article>
          <article>
            <h3>Conversation Volume</h3>
            <canvas id="volumeChart"></canvas>
          </article>
        </div>
      </section>
    </main>

    <script>
      const trends = {{ trends_json | safe }};

      function renderLineChart(canvasId, dataset, label, color) {
        const ctx = document.getElementById(canvasId);
        const labels = dataset.map((entry) => entry.date);
        const data = dataset.map((entry) => entry.value);
        new Chart(ctx, {
          type: 'line',
          data: {
            labels,
            datasets: [
              {
                label,
                data,
                fill: false,
                borderColor: color,
                tension: 0.25,
              },
            ],
          },
          options: {
            responsive: true,
            plugins: {
              legend: {
                display: false,
              },
            },
            scales: {
              y: {
                beginAtZero: true,
              },
            },
          },
        });
      }

      renderLineChart('qualityChart', trends.quality, 'Quality', '#2962ff');
      renderLineChart('agentChart', trends.agent, 'Agent score', '#2e7d32');
      renderLineChart('volumeChart', trends.volume, 'Volume', '#ff6f00');
    </script>
  </body>
</html>
